<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Gamedev Canvas Workshop</title>
  </head>
  <body>
    <script>

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      canvas.width = 400;
      canvas.height = 400;

      canvas.setAttribute('style', 'display: block; margin:0 auto; background-color: #ddd;');

      document.body.appendChild(canvas);




      const ball = {
        x: null,
        y: null,
        width: 5,
        height: 5,
        speed: 3,
        dx: null,
        dy: null,

        update: function() {
          ctx.fillRect(this.x, this.y, this.width, this.height);
          ctx.fill();


          if(this.x < 0 || this.x > canvas.width) this.dx *= -1;
          if(this.y < 0) {
            this.dy *= -1;
          } else if(this.y > canvas.height) {
            alert("GAME OVER");
            document.location.reload();
            clearInterval(interval);
          }

          this.x += this.dx;
          this.y += this.dy;
        }
      }

      const paddle = {
        x: null,
        y: null,
        width: 100,
        height: 15,
        speed: 0,

        update: function() {
          ctx.fillRect(this.x, this.y, this.width, this.height);
          ctx.fill();

          this.x += this.speed;

        }
      }
      const block = {
        width: null,
        height: 20,
        data: [],

        update: function() {
          this.data.forEach(brick => {
            ctx.strokeRect(brick.x, brick.y, brick.width, brick.height);
            ctx.stroke();
          })
        }
      }

      let level = 0


      let level0 = [
        [0,0,0,0,0,0],
        [0,0,0,0,0,0],
        [1,1,1,1,1,1],
        [1,1,1,1,1,1],
        [1,1,1,1,1,1],
        [1,1,1,1,1,1],
      ]

      let level1 = [
        [1,0,1,0,0,1],
        [0,1,1,1,1,0],
        [1,0,0,0,0,1],
        [1,0,0,0,0,1],
        [1,1,1,1,1,1],
        [1,1,1,1,1,1],
      ]

      let score = 0;

      const drawScore = {

        update: function() {
          ctx.font = "16px Arial";
          ctx.fillStyle = "#0095DD";
          ctx.fillText("Score: " + score, 8, 20);
        }
      }


      const init = () => {
        paddle.x = canvas.width / 2 - paddle.width / 2;
        paddle.y = canvas.height - paddle.height;

        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2 + 50;
        ball.dx = ball.speed;
        ball.dy = ball.speed;

        block.width = canvas.width / level[0].length;

        for(let i = 0; i < level.length; i++) {
          for(let j = 0; j < level[i].length; j++) {
            if(level[i][j]) {
              block.data.push({
                x: block.width * j,
                y: block.height * i,
                width: block.width,
                height: block.height
              })
            }
          }
        }
      }

      const collide = (obj1, obj2) => {
        return obj1.x < obj2.x + obj2.width &&
               obj2.x < obj1.x + obj1.width &&
               obj1.y < obj2.y + obj2.height &&
               obj2.y < obj1.y + obj1.height;
      }
      const loop = () => {
        ctx.clearRect(0,0,canvas.width,canvas.height);

        paddle.update();
        ball.update();
        block.update();
        drawScore.update();

        if(collide(ball, paddle)) {
          ball.dy *= -1;
          ball.y = paddle.y - ball.height;
        }

        block.data.forEach((brick, index) => {
          if(collide(ball, brick)) {
            ball.dy *= -1;
            score++;
            if(block.data.splice(index, 1));
            if(score == 24) {
              alert("YOU WIN, CONGRATULATION!");
              // document.location.reload();
            }
            level++
          }
        })

        const interval = window.requestAnimationFrame(loop);
      }

      init();
      loop();

      document.addEventListener('keydown', e => {
        if(e.key == 'ArrowLeft') paddle.speed = -6;
        if(e.key == 'ArrowRight') paddle.speed = 6;
      });
      document.addEventListener('keyup', () => paddle.speed = 0);
    </script>
  </body>
</html>